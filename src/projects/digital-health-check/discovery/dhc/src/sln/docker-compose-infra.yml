# Please refer https://aka.ms/HTTPSinContainer on how to setup an https developer certificate for your ASP .NET Core service.

version: '3.4'

services:

  db:
    image: sqlserver
    build:
      context: ./sql
      dockerfile: Dockerfile
    environment:
        SA_PASSWORD: "Yukon900"
        ACCEPT_EULA: "Y"
    ports:
      - 1433:1433 

  rabbitmq:
    image: rabbitmq:3.10.7-management-alpine
    container_name: 'rabbitmq'
    ports:
        - 5672:5672
        - 15672:15672
    volumes:
        - ~/.docker-conf/rabbitmq/data/:/var/rabbitmq/lib/
        - ~/.docker-conf/rabbitmq/log/:/var/rabbitmq/log/

  eventstore.db:
      image: eventstore/eventstore:20.10.2-buster-slim
      environment:
        - EVENTSTORE_CLUSTER_SIZE=1
        - EVENTSTORE_RUN_PROJECTIONS=All
        - EVENTSTORE_START_STANDARD_PROJECTIONS=true
        - EVENTSTORE_EXT_TCP_PORT=1113
        - EVENTSTORE_HTTP_PORT=2113
        - EVENTSTORE_INSECURE=true
        - EVENTSTORE_ENABLE_EXTERNAL_TCP=true
        - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
      ports:
        - "1113:1113"
        - "2113:2113"
      volumes:
        - type: volume
          source: eventstore-volume-data
          target: /var/lib/eventstore
        - type: volume
          source: eventstore-volume-logs
          target: /var/log/eventstore        

volumes:
  eventstore-volume-data:
  eventstore-volume-logs:          